Version 4
SHEET 1 880 900
WIRE -336 -192 -368 -192
WIRE 112 -192 -336 -192
WIRE 112 -144 112 -192
WIRE -64 -64 -208 -64
WIRE 64 -64 16 -64
WIRE -208 -32 -208 -64
WIRE -368 16 -368 -192
WIRE -208 80 -208 48
WIRE 112 80 112 -48
WIRE 112 80 -208 80
WIRE 192 80 112 80
WIRE 304 80 224 80
WIRE 432 80 384 80
WIRE 576 80 512 80
WIRE 672 80 576 80
WIRE 704 80 672 80
WIRE 576 144 576 80
WIRE 208 176 208 96
WIRE 256 176 208 176
WIRE 304 176 256 176
WIRE 704 176 704 80
WIRE 112 192 112 80
WIRE 576 240 576 208
WIRE -368 368 -368 96
WIRE 112 368 112 256
WIRE 112 368 -368 368
WIRE 576 368 576 320
WIRE 576 368 112 368
WIRE 704 368 704 256
WIRE 704 368 576 368
WIRE -368 416 -368 368
WIRE 112 496 16 496
WIRE 160 496 112 496
WIRE 160 656 160 496
WIRE 208 656 160 656
WIRE 384 656 304 656
WIRE 416 656 384 656
WIRE -208 688 -240 688
WIRE -32 688 -208 688
WIRE 144 704 32 704
WIRE 208 704 144 704
WIRE -96 720 -144 720
WIRE -32 720 -96 720
WIRE -144 784 -144 720
WIRE -144 784 -176 784
FLAG -368 416 0
FLAG 672 80 out
FLAG -336 -192 in
FLAG 256 176 isw
FLAG 384 656 gate
FLAG -208 688 isw
FLAG -96 720 iref
FLAG 144 704 comp
FLAG 112 496 clk
SYMBOL ind 416 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 100µ
SYMBOL cap 560 144 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL res 688 160 R0
SYMATTR InstName R1
SYMATTR Value 5
SYMBOL voltage -368 0 R0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL res 400 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 50m
SYMBOL res 560 224 R0
SYMATTR InstName R3
SYMATTR Value 200m
SYMBOL Control\\isense 208 80 R0
WINDOW 0 0 -28 Bottom 2
SYMATTR InstName U4
SYMBOL Control\\comp 0 704 R0
WINDOW 3 -7 27 Left 2
WINDOW 123 -2 55 Left 2
SYMATTR Value Vhigh=1
SYMATTR Value2 Vlow=0
SYMATTR InstName U3
SYMBOL Control\\clk -16 496 R0
WINDOW 38 -72 19 Bottom 2
WINDOW 3 3 74 Bottom 2
WINDOW 123 7 107 Bottom 2
WINDOW 39 2 135 Bottom 2
SYMATTR Value tdelay=0 Vhigh=1
SYMATTR Value2 SR=1e8 ton=1u
SYMATTR InstName U5
SYMBOL Digital\\srflop 256 608 R0
SYMATTR InstName A1
SYMBOL Control\\constant -208 784 R0
WINDOW 3 -9 64 Bottom 2
SYMATTR Value K=1.75
SYMATTR InstName U6
SYMBOL nmos 64 -144 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL res 32 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL Misc\\Epoly -208 -48 R0
WINDOW 0 49 34 Left 2
WINDOW 3 38 60 Left 2
SYMATTR InstName E1
SYMATTR Value value={V(gate)*15}
SYMBOL Control\\idiode 128 256 R180
WINDOW 3 24 -28 Left 2
WINDOW 123 24 -56 Left 2
SYMATTR InstName U1
TEXT 280 -56 Left 2 !.tran 0 800u 600u 0.1u
TEXT 288 -96 Left 2 !.options reltol=1m
